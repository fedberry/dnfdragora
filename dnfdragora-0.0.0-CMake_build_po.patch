From 9d84e16303693e6c3cab1211310856276227d832 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bj=C3=B6rn=20Esser?= <besser82@fedoraproject.org>
Date: Sat, 4 Feb 2017 20:33:54 +0100
Subject: [PATCH 1/2] CMake: Generate and install translations

---
 CMakeLists.txt    |  6 ++++++
 po/CMakeLists.txt | 13 +++++++++++++
 2 files changed, 19 insertions(+)
 create mode 100644 po/CMakeLists.txt

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 735243d..9327bde 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -7,6 +7,7 @@ include(FindPkgConfig)
 include(GNUInstallDirs)
 
 find_package(PythonInterp 3.4 REQUIRED)
+find_package(Gettext)
 
 execute_process(COMMAND ${PYTHON_EXECUTABLE} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib(), end='')" OUTPUT_VARIABLE PYTHON_INSTALL_DIR)
 string(REGEX REPLACE "\n$" "" ${PYTHON_INSTALL_DIR} "${PYTHON_INSTALL_DIR}")
@@ -40,6 +41,11 @@ endif(ENABLE_COMPS)
 # Configure files
 configure_file(${CMAKE_SOURCE_DIR}/etc/dnfdragora.yaml.in ${CMAKE_BINARY_DIR}/etc/dnfdragora.yaml @ONLY)
 
+# Build and install translations
+if(GETTEXT_FOUND)
+	add_subdirectory(po)
+endif(GETTEXT_FOUND)
+
 # Installing application code
 install(PROGRAMS ${CMAKE_SOURCE_DIR}/bin/dnfdragora DESTINATION ${CMAKE_INSTALL_BINDIR})
 install(DIRECTORY ${CMAKE_SOURCE_DIR}/dnfdragora DESTINATION ${PYTHON_INSTALL_DIR})
diff --git a/po/CMakeLists.txt b/po/CMakeLists.txt
new file mode 100644
index 0000000..9ac1dc0
--- /dev/null
+++ b/po/CMakeLists.txt
@@ -0,0 +1,13 @@
+# Find all translation-files
+file(GLOB PO_FILES "${CMAKE_CURRENT_SOURCE_DIR}/*.po")
+
+# Generate and install each translation in a separate target
+foreach(PO_FILE ${PO_FILES})
+	string(REPLACE "${CMAKE_CURRENT_SOURCE_DIR}/" "" LANG_NAME "${PO_FILE}")
+	string(REPLACE ".po" "" LANG_NAME "${LANG_NAME}")
+	gettext_process_po_files("${LANG_NAME}" ALL PO_FILES "${PO_FILE}")
+	install(FILES "${CMAKE_CURRENT_BINARY_DIR}/${LANG_NAME}.gmo"
+		DESTINATION "${CMAKE_INSTALL_LOCALEDIR}/${LANG_NAME}/LC_MESSAGES/"
+		RENAME "dnfdragora.mo"
+	)
+endforeach(PO_FILE ${PO_FILES})

From a5fd1c7a6523a2718df9b7259574cc5cda12fcf0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bj=C3=B6rn=20Esser?= <besser82@fedoraproject.org>
Date: Sat, 4 Feb 2017 20:35:04 +0100
Subject: [PATCH 2/2] CMake: Silence developer warning

---
 CMakeLists.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 9327bde..486e679 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,4 +1,4 @@
-project(dnfdragora NONE)
+project(dnfdragora C)
 cmake_minimum_required(VERSION 3.4)
 
 set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake")
